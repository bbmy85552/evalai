# AI 模型对比工具功能方案
## 🎯 核心对比功能
### 1. 多模型并行测试
+ **同步调用**：一个 prompt 同时发送给多个模型  
+ **流式对比**：实时显示各模型的响应过程  
+ **响应时间对比**：记录首个 token 响应时间、完成时间  
+ **并发控制**：可设置同时测试的模型数量

### 2. 预设 Prompt 库
+ **分类管理**：代码生成、文本创作、逻辑推理、翻译、角色扮演等  
+ **难度分级**：简单、中等、困难、专家级  
+ **行业专用**：金融、医疗、教育、法律等专业领域  
+ **动态更新**：定期更新热门和有代表性的测试用例

### 3. 交互式对比界面
+ **并排显示**：分栏显示各模型回答  
+ **差异高亮**：自动标记回答中的关键差异  
+ **隐藏/显示**：可选择性隐藏某些模型结果  
+ **实时投票**：支持多用户实时投票选择最佳回答

---

## 📊 评分与排名系统
### 1. 多维度评分
+ **主观评分**：用户手动评分（1–10 分）  
+ **客观指标**：响应速度、Token 效率、成本效益  
+ **质量评估**：准确性、相关性、完整性、创造性  
+ **权重配置**：可自定义各评分维度权重

### 2. 排名算法
+ **综合排名**：基于多维度加权计算  
+ **分类排名**：按任务类型的专项排名  
+ **趋势排名**：基于历史数据的性能趋势  
+ **用户偏好排名**：基于个人使用习惯的个性化排名

### 3. 数据持久化
+ **结果存储**：保存每次对比的完整数据  
+ **历史查询**：按时间、模型、Prompt 类型筛选  
+ **统计分析**：生成性能报告和趋势分析  
+ **数据导出**：支持 Excel、CSV、JSON 格式导出

---

## 🤖 模型信息收集系统
### 1. 自动化数据收集
+ **API 扫描**：定期扫描各厂商 API 获取最新模型信息  
+ **网络爬虫**：收集官方发布的模型数据和性能指标  
+ **社区监控**：抓取技术论坛和社交媒体的讨论热度  
+ **基准测试**：运行标准化测试获取实际性能数据

### 2. 模型档案管理
+ **基本信息**：模型名称、版本、发布时间、厂商信息  
+ **技术规格**：参数量、训练数据、上下文长度、支持语言  
+ **性能指标**：基准测试得分、响应速度、Token 价格  
+ **特色功能**：支持的功能（如代码解释、图像识别等）

### 3. 智能预测系统
+ **趋势分析**：基于历史数据预测模型发展方向  
+ **性能预测**：预测新模型的潜在性能表现  
+ **市场分析**：预测各厂商的市场份额变化  
+ **推荐系统**：基于用户需求推荐最适合的模型

---

## 🚀 扩展功能建议
### 1. 高级分析功能
+ **语义相似度分析**：使用 NLP 技术分析回答相似性  
+ **偏见检测**：检测模型回答中的潜在偏见  
+ **安全性评估**：检测有害内容和安全风险  
+ **一致性测试**：多次测试同一问题的回答一致性

### 2. 成本优化功能
+ **智能路由**：根据任务类型自动选择性价比最高的模型  
+ **预算管理**：设置月度预算，超出预警  
+ **成本分析**：详细的成本构成分析和优化建议  
+ **批量优惠**：整合各厂商的定价策略和优惠政策

### 3. 协作与分享
+ **团队协作**：多用户协同测试和评分  
+ **结果分享**：生成对比报告链接，支持分享  
+ **社区功能**：用户分享测试用例和评分结果  
+ **专家评审**：邀请领域专家进行专业评价

### 4. 个性化功能
+ **用户画像**：基于使用习惯分析用户偏好  
+ **自定义评估**：用户可以定义自己的评分标准  
+ **收藏功能**：收藏优质的模型回答  
+ **学习模式**：基于历史数据学习用户的评分模式

### 5. 开发者工具
+ **API 接口**：提供 RESTful API 供第三方集成  
+ **Webhook**：支持测试结果回调  
+ **SDK**：提供 Python、JavaScript 等语言的 SDK  
+ **插件系统**：支持浏览器插件和 IDE 集成

### 6. 监控与告警
+ **服务监控**：监控各模型 API 的可用性和性能  
+ **异常告警**：API 异常、价格变动等实时告警  
+ **性能报告**：定期生成性能分析报告  
+ **SLA 跟踪**：跟踪各厂商的服务水平协议

---

## 👤 用户管理系统
### 1. 用户认证与授权
+ **注册登录**：邮箱/手机号注册，第三方登录（微信、Google等）
+ **身份验证**：双因素认证，短信验证码
+ **权限管理**：普通用户、VIP用户、管理员等不同权限级别
+ **账户安全**：密码强度检测，异常登录监控

### 2. API密钥管理
+ **自有API密钥**：用户可添加和管理自己的API密钥
+ **平台测试账户**：提供平台统一的测试API接口
+ **密钥安全**：加密存储，定期轮换，访问日志记录
+ **使用配额**：可设置各API密钥的使用限制和预算

## 🔒 用户API密钥安全机制

### 安全原则
我们高度重视用户API密钥的安全性，采用以下措施保护用户权益：

#### 1. 密钥存储策略
- **不存储用户密钥**：用户的自定义API密钥不会明文存储在数据库中
- **本地加密存储**：密钥在用户本地浏览器中使用加密存储（localStorage/sessionStorage）
- **服务端无痕**：服务端仅在请求处理时临时获取密钥，处理完成后立即销毁

#### 2. 通信加密保护
- **HTTPS传输**：所有客户端与服务器之间的通信都采用HTTPS加密
- **密钥二次加密**：用户密钥在传输前进行客户端加密，服务端解密使用
- **一次性令牌**：使用JWT令牌进行身份验证，避免密钥重复传输

#### 3. 密钥使用流程
```
用户输入API密钥 → 客户端加密 → 发送到服务端 → 
服务端临时使用 → 立即销毁 → 返回结果
```

#### 4. 安全保障措施
- **访问日志**：记录密钥使用情况，便于异常检测
- **频率限制**：防止密钥被恶意滥用
- **自动失效**：用户可随时撤销密钥授权
- **安全审计**：定期安全检查和漏洞扫描

#### 5. 用户权益保护
- **完全控制权**：用户对自己的API密钥拥有完全控制权
- **随时删除**：可随时删除已保存的密钥信息
- **使用透明**：提供详细的使用记录和统计
- **责任明确**：明确平台与用户的安全责任边界

### 技术实现要点
- 使用AES-256加密算法对用户密钥进行客户端加密
- 采用零知识架构，服务端无法获取用户原始密钥
- 实现密钥轮换机制，支持定期更新密钥
- 提供密钥使用异常告警功能

### 3. 预充值计费系统
+ **充值功能**：支持支付宝、微信、信用卡等多种支付方式
+ **Token计费**：按照实际Token消耗进行精确计费
+ **余额管理**：实时余额查询，充值记录查询
+ **消费预警**：余额不足时提前通知，自动充值设置

### 4. 用户仪表盘
+ **使用统计**：模型调用次数、Token消耗量、响应时间统计
+ **费用分析**：每日/每周/每月费用趋势，成本构成分析
+ **账单管理**：详细账单记录，支持导出PDF/Excel格式
+ **预算控制**：设置月度预算上限，超预算自动停止服务

### 5. 优惠与促销
+ **新用户优惠**：注册赠送免费Token额度
+ **充值优惠**：不同充值档位的折扣优惠
+ **会员等级**：根据消费金额提供不同等级的优惠
+ **推荐奖励**：推荐新用户获得Token奖励

---

## 🗄️ 数据库设计

### 核心表结构

#### 1. users (用户表 - 含权限)
| 字段名 | 数据类型 | 约束 | 说明 |
|--------|----------|------|------|
| id | BIGINT | PK, AUTO_INCREMENT | 用户ID |
| username | VARCHAR(50) | UNIQUE, NOT NULL | 用户名 |
| email | VARCHAR(100) | UNIQUE, NOT NULL | 邮箱 |
| password_hash | VARCHAR(255) | NOT NULL | 密码哈希 |
| balance | DECIMAL(10,2) | DEFAULT 0.00 | 账户余额 |
| status | ENUM('active','inactive','banned') | DEFAULT 'active' | 状态 |
| permissions | JSON | NULL | 权限配置(ABAC) |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |

#### 2. models (模型表 - 含档案)
| 字段名 | 数据类型 | 约束 | 说明 |
|--------|----------|------|------|
| id | BIGINT | PK, AUTO_INCREMENT | 模型ID |
| name | VARCHAR(100) | NOT NULL | 模型名称 |
| provider | VARCHAR(50) | NOT NULL | 提供商 |
| description | TEXT | NULL | 描述 |
| version | VARCHAR(20) | NOT NULL | 版本 |
| input_price | DECIMAL(10,6) | NOT NULL | 输入价格 |
| output_price | DECIMAL(10,6) | NOT NULL | 输出价格 |
| parameters | BIGINT | NULL | 参数量 |
| context_length | INT | NULL | 上下文长度 |
| languages | JSON | NULL | 支持语言 |
| features | JSON | NULL | 特色功能 |
| benchmark_scores | JSON | NULL | 基准测试分数 |
| status | ENUM('active','inactive') | DEFAULT 'active' | 状态 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |

#### 3. api_requests (API请求统一表)
| 字段名 | 数据类型 | 约束 | 说明 |
|--------|----------|------|------|
| id | BIGINT | PK, AUTO_INCREMENT | 请求ID |
| user_id | BIGINT | FK(users.id), NOT NULL | 用户ID |
| model_id | BIGINT | FK(models.id), NOT NULL | 模型ID |
| api_key | TEXT | NOT NULL | API密钥 |
| api_name | VARCHAR(100) | NOT NULL | API服务名称 |
| is_platform | BOOLEAN | DEFAULT FALSE | 是否平台提供 |
| prompt | TEXT | NOT NULL | 问题/提示词 |
| prompt_category | VARCHAR(50) | NULL | 提示词分类 |
| response | TEXT | NOT NULL | 模型回答 |
| input_tokens | INT | NOT NULL | 输入Token数 |
| thinking_tokens | INT | DEFAULT 0 | 思考Token数 |
| output_tokens | INT | NOT NULL | 输出Token数 |
| total_tokens | INT | NOT NULL | 总Token数 |
| input_cost | DECIMAL(10,6) | NOT NULL | 输入成本 |
| thinking_cost | DECIMAL(10,6) | DEFAULT 0.00 | 思考成本 |
| output_cost | DECIMAL(10,6) | NOT NULL | 输出成本 |
| total_cost | DECIMAL(10,6) | NOT NULL | 总成本 |
| response_time | INT | NOT NULL | 响应时间(ms) |
| rating_score | DECIMAL(3,2) | NULL | 评分(1-5分) |
| rating_comment | TEXT | NULL | 评分评语 |
| status | ENUM('success','failed','timeout') | DEFAULT 'success' | 状态 |
| error_message | TEXT | NULL | 错误信息 |
| balance_before | DECIMAL(10,2) | NOT NULL | 请求前余额 |
| balance_after | DECIMAL(10,2) | NOT NULL | 请求后余额 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |

#### 4. crawl_results (爬取结果表)
| 字段名 | 数据类型 | 约束 | 说明 |
|--------|----------|------|------|
| id | BIGINT | PK, AUTO_INCREMENT | 结果ID |
| source | VARCHAR(50) | NOT NULL | 数据来源 |
| model_name | VARCHAR(100) | NOT NULL | 模型名称 |
| provider | VARCHAR(50) | NOT NULL | 提供商 |
| raw_data | JSON | NOT NULL | 原始数据 |
| processed_data | JSON | NULL | 处理后数据 |
| confidence_score | DECIMAL(3,2) | NULL | 置信度 |
| crawl_time | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 爬取时间 |
| status | ENUM('new','processed','invalid') | DEFAULT 'new' | 处理状态 |

### 表结构说明

1. **极致简化**：从原来的12个表精简为4个核心表，大幅减少冗余和维护复杂度
2. **用户权限集成**：`users` 表通过JSON字段存储ABAC权限配置，简化权限管理
3. **模型信息统一**：`models` 表集成基础信息和详细档案，便于模型展示页面开发
4. **API请求全追踪**：`api_requests` 表记录每次请求的完整信息，包括：
   - 详细的Token消耗（输入、思考、输出）
   - 精确的成本计算（分项成本和总成本）
   - 请求前后的余额变化
   - 对单个回答的评分和评语
   - 完整的请求-响应对
5. **用户管理支撑**：基于 `api_requests` 表可轻松实现：
   - 使用次数统计
   - Token消耗分析
   - 成本计算和账单生成
   - 评分统计和分析
   - API服务性能监控
6. **爬虫数据独立**：`crawl_results` 表专门存储爬取的模型信息，支持自动化数据收集

---

## 🎨 用户体验优化
### 1. 界面设计
+ **暗黑模式**：支持深色主题  
+ **多语言**：支持中英文切换  
+ **响应式设计**：适配各种设备屏幕  
+ **快捷操作**：键盘快捷键和右键菜单

### 2. 交互优化
+ **拖拽排序**：支持拖拽调整模型显示顺序  
+ **标签过滤**：使用标签快速筛选模型  
+ **搜索功能**：智能搜索历史测试记录  
+ **操作历史**：支持撤销和重做操作

